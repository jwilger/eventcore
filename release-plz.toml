[workspace]
# Update all workspace members together
release_always = true

# Allow dirty working directory (for CI)
allow_dirty = true

# Dependencies update
# TODO: Re-enable after initial release (temporarily disabled because workspace dependencies are not yet published to crates.io)
dependencies_update = false

# Note: Due to failed release attempts, v0.1.1 and v0.1.2 tags exist but weren't fully published.
# The workspace is at v0.1.3 to bypass these issues.

# Git configuration
git_release_enable = true  # Create GitHub releases
git_tag_enable = true      # Create git tags
git_tag_name = "v{{ version }}"  # Single tag for all packages: v0.1.8

# PR configuration
pr_labels = ["release", "automated"]
pr_draft = true  # Create release PRs as drafts

# Changelog configuration
changelog_update = true

[changelog]
# Use conventional commits for changelog generation
# Group commits by type for better organization
commit_parsers = [
  { message = "^feat", group = "Features" },
  { message = "^fix", group = "Bug Fixes" },
  { message = "^docs", group = "Documentation" },
  { message = "^perf", group = "Performance" },
  { message = "^refactor", group = "Refactoring" },
  { message = "^style", group = "Style" },
  { message = "^test", group = "Testing" },
  { message = "^chore\\(release\\):", skip = true },
  { message = "^chore\\(deps\\)", group = "Dependencies" },
  { message = "^chore\\(deps-dev\\)", group = "Development Dependencies" },
  { message = "^chore", group = "Miscellaneous Tasks" },
  { message = "^build", group = "Build System" },
  { message = "^ci", group = "Continuous Integration" },
  { message = "^revert", group = "Reverts" },
]

# Sort commit groups in a logical order
sort_commits = "oldest"

# Use scope from conventional commits when present
protect_breaking_commits = true

# Package-specific configuration
#
# IMPORTANT: Package order in this file defines publication order (ADR-025)
# release-plz publishes in dependency order to prevent "missing dependency" errors
#
# Dependency graph (bottom-up publication):
# 1. eventcore-types (no internal dependencies)
# 2. eventcore-macros (no internal dependencies)
# 3. eventcore-testing, eventcore-memory, eventcore-postgres (depend on eventcore-types)
# 4. eventcore (depends on all via feature flags)
#
# See ADR-025 for versioning policy and rationale

# Layer 1: Foundation types (no internal dependencies)
[[package]]
name = "eventcore-types"
release = true
changelog_include = ["eventcore-types/**"]
changelog_path = "./eventcore-types/CHANGELOG.md"

# Layer 2: Proc macros (no internal dependencies)
[[package]]
name = "eventcore-macros"
release = true
changelog_include = ["eventcore-macros/**"]
changelog_path = "./eventcore-macros/CHANGELOG.md"

# Layer 3: Testing utilities (depends on eventcore-types)
[[package]]
name = "eventcore-testing"
release = true
changelog_include = ["eventcore-testing/**"]
changelog_path = "./eventcore-testing/CHANGELOG.md"

# Layer 3: In-memory adapter (depends on eventcore-types)
[[package]]
name = "eventcore-memory"
release = true
changelog_include = ["eventcore-memory/**"]
changelog_path = "./eventcore-memory/CHANGELOG.md"

# Layer 3: PostgreSQL adapter (depends on eventcore-types)
[[package]]
name = "eventcore-postgres"
release = true
changelog_include = ["eventcore-postgres/**"]
changelog_path = "./eventcore-postgres/CHANGELOG.md"

# Layer 4: Main facade crate (depends on all via feature flags)
[[package]]
name = "eventcore"
release = true
changelog_include = ["eventcore/src/**", "eventcore/Cargo.toml"]
changelog_exclude = ["eventcore-macros/**", "eventcore-types/**", "eventcore-testing/**", "eventcore-memory/**", "eventcore-postgres/**"]
changelog_path = "./eventcore/CHANGELOG.md"

# Don't publish example and benchmark crates
[[package]]
name = "eventcore-examples"
publish = false

[[package]]
name = "eventcore-benchmarks"
publish = false
