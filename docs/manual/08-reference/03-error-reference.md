# Chapter 7.3: Error Reference

This chapter provides a comprehensive reference for all EventCore error types, error codes, and troubleshooting guidance. Use this reference to understand and resolve errors in your EventCore applications.

## Error Categories

EventCore errors are organized into several categories based on their origin and nature:

1. **Command Errors** - Errors during command execution
2. **Event Store Errors** - Errors from event store operations
3. **Projection Errors** - Errors in projection processing
4. **Validation Errors** - Input validation failures
5. **Configuration Errors** - Configuration and setup issues
6. **Network Errors** - Network and connectivity issues
7. **Serialization Errors** - Data serialization/deserialization issues

## Command Errors

### CommandError

The primary error type for command execution failures.

```rust
#[derive(Debug, thiserror::Error)]
pub enum CommandError {
    #[error("Validation failed: {message}")]
    ValidationFailed { message: String },

    #[error("Business rule violation: {rule} - {message}")]
    BusinessRuleViolation { rule: String, message: String },

    #[error("Concurrency conflict on streams: {streams:?}")]
    ConcurrencyConflict { streams: Vec<StreamId> },

    #[error("Stream not found: {stream_id}")]
    StreamNotFound { stream_id: StreamId },

    #[error("Unauthorized: {permission}")]
    Unauthorized { permission: String },

    #[error("Timeout after {duration:?}")]
    Timeout { duration: Duration },

    #[error("Stream access denied: cannot write to {stream_id}")]
    StreamAccessDenied { stream_id: StreamId },

    #[error("Maximum discovery iterations exceeded: {iterations}")]
    MaxIterationsExceeded { iterations: usize },

    #[error("Event store error: {source}")]
    EventStoreError {
        #[from]
        source: EventStoreError
    },

    #[error("Serialization error: {message}")]
    SerializationError { message: String },

    #[error("Internal error: {message}")]
    InternalError { message: String },
}
```

#### Error Codes and Solutions

**CE001: ValidationFailed**

```
Error: Validation failed: StreamId cannot be empty
Code: CE001
```

**Cause:** Input validation failed during command construction or execution.
**Solution:**

- Check input parameters for correct format and constraints
- Ensure all required fields are provided
- Verify string lengths and format requirements

**CE002: BusinessRuleViolation**

```
Error: Business rule violation: insufficient_balance - Account balance $100.00 is less than transfer amount $150.00
Code: CE002
```

**Cause:** Business logic constraints were violated.
**Solution:**

- Review business rules and ensure command logic respects them
- Check application state before executing commands
- Implement proper validation in command handlers

**CE003: ConcurrencyConflict**

```
Error: Concurrency conflict on streams: ["account-123", "account-456"]
Code: CE003
```

**Cause:** Multiple commands attempted to modify the same streams simultaneously.
**Solution:**

- Implement retry logic with exponential backoff
- Consider command design to reduce conflicts
- Use optimistic concurrency control patterns

**CE004: StreamNotFound**

```
Error: Stream not found: account-nonexistent
Code: CE004
```

**Cause:** Command attempted to read from a stream that doesn't exist.
**Solution:**

- Verify stream IDs are correct
- Check if the resource exists before referencing it
- Implement proper error handling for missing resources

**CE005: Unauthorized**

```
Error: Unauthorized: write_account_events
Code: CE005
```

**Cause:** Insufficient permissions to execute the command.
**Solution:**

- Verify user authentication and authorization
- Check role-based access control configuration
- Ensure proper security context is set

**CE006: Timeout**

```
Error: Timeout after 30s
Code: CE006
```

**Cause:** Command execution exceeded configured timeout.
**Solution:**

- Check system performance and database connectivity
- Increase timeout configuration if appropriate
- Optimize command logic and database queries

**CE007: StreamAccessDenied**

```
Error: Stream access denied: cannot write to protected-stream-123
Code: CE007
```

**Cause:** Command attempted to write to a stream it didn't declare.
**Solution:**

- Ensure the command declares the stream via its `stream_declarations()` (generated by `#[derive(Command)]`) or otherwise includes the stream in its `StreamDeclarations` value
- Verify command design follows EventCore stream access patterns
- Check for typos in stream ID generation

**CE008: MaxIterationsExceeded**

```
Error: Maximum discovery iterations exceeded: 10
Code: CE008
```

**Cause:** Stream discovery loop exceeded configured maximum iterations.
**Solution:**

- Review command logic for potential infinite discovery loops
- Increase `max_discovery_iterations` if legitimate
- Optimize stream discovery patterns

### Command Execution Flow Errors

These errors occur during specific phases of command execution:

```rust
#[derive(Debug, thiserror::Error)]
pub enum ExecutionPhaseError {
    #[error("Stream reading failed: {message}")]
    StreamReadError { message: String },

    #[error("State reconstruction failed: {message}")]
    StateReconstructionError { message: String },

    #[error("Command handling failed: {message}")]
    CommandHandlingError { message: String },

    #[error("Event writing failed: {message}")]
    EventWritingError { message: String },

    #[error("Stream discovery failed: {message}")]
    StreamDiscoveryError { message: String },
}
```

... (rest of file unchanged)
